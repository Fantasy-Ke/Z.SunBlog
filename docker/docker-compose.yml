version: "3.9"

volumes:
  nginx_log:
  hostbolg_logs:
  vueblog_assets:
  adminvue_assets:

configs:
  nginx_conf:
    file: ./env/nginx/nginx.conf

networks:
  fantasy_net:
    driver: bridge
    attachable: true

services:
  # hostbolg
  hostbolg:
    image: registry.cn-hangzhou.aliyuncs.com/learn-zhou/zhou-learn:${HOSTTAG}
    restart: always
    networks:
      - fantasy_net
    volumes:
      - "hostbolg_logs:/app/App_Data/Logs"
    environment:
      - App__DbType=${DBYTPE}
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_HTTP_PORTS=80
      - App__ConnectionString__Mysql=${CONNECTIONSTRINGMYSQL}
      - App__ConnectionString__SqlServer=${CONNECTIONSTRINGSQLSERVER}
      - App__CorsOrigins=${CORSORIGINS}

  vueblog:
    image: registry.cn-hangzhou.aliyuncs.com/learn-zhou/zhou-learn:${VUETAG}
    networks:
      - fantasy_net
    volumes:
      - vueblog_assets:/usr/share/nginx/html/assets

  adminvue:
    image: registry.cn-hangzhou.aliyuncs.com/learn-zhou/zhou-learn:${ADMINTAG}
    networks:
      - fantasy_net
    volumes:
      - adminvue_assets:/usr/share/nginx/html/assets

  nginx:
    image: nginx:1.16.1
    ports:
      - "5100:5100"
      - "5200:5200"
      - "5155:5155"
    networks:
      - fantasy_net
    volumes:
      - "nginx_log:/var/log/nginx"
    configs:
      - source: nginx_conf
        target: /etc/nginx/nginx.conf
